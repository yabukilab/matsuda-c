<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ”ã‚¢ãƒãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    /* ã‚¹ã‚¿ã‚¤ãƒ«çœç•¥ */
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginScreen" class="screen active">
      <div class="card">
        <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <div class="form-group">
          <label for="studentId">å—è¬›è€…ç•ªå·ï¼ˆ7æ¡ï¼‰</label>
          <input id="studentId" type="text" maxlength="7" placeholder="1234567">
        </div>
        <div class="form-group">
          <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input id="password" type="password" placeholder="demo1234">
        </div>
        <p>â€»ãƒ‡ãƒ¢ç”¨ID: <strong>1234567</strong> / PW: <strong>demo1234</strong></p>
        <button class="btn" onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
      </div>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ç”»é¢ -->
    <div id="loginErrorScreen" class="screen">
      <div class="card error-message">
        <h3>ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼</h3>
        <p>IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚</p>
      </div>
      <button class="btn-secondary btn" onclick="showScreen('loginScreen')">æˆ»ã‚‹</button>
    </div>

    <!-- äºˆç´„ç”»é¢ -->
    <div id="reservationScreen" class="screen">
      <div class="card">
        <h2>ğŸ¹ ãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„</h2>
        <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º -->
        <p>ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <strong><span id="currentUserDisplay"></span></strong></p>
        <!-- è¬›å¸«ã¯1åã®ã¿ -->
        <div class="lesson-info">
          <h3>è¬›å¸«: ç”°ä¸­å…ˆç”Ÿ</h3>
        </div>

        <!-- æ—¥ä»˜é¸æŠ -->
        <h3>ğŸ“… ãƒ¬ãƒƒã‚¹ãƒ³æ—¥</h3>
        <div class="calendar-header">
          <button class="calendar-nav" onclick="changeMonth(-1)">â—€</button>
          <div id="currentMonth" class="calendar-month"></div>
          <button class="calendar-nav" onclick="changeMonth(1)">â–¶</button>
        </div>
        <div id="calendar" class="calendar"></div>

        <!-- æ™‚é–“å¸¯é¸æŠ -->
        <div id="timeSection" class="time-slots"></div>

        <!-- è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå…¥åŠ› -->
        <div class="form-group">
          <label for="userIds">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°å…¥åŠ›)</label>
          <input id="userIds" type="text" placeholder="1234567,2345678,3456789">
        </div>

        <button class="btn" onclick="reserveSequential()">äºˆç´„ã™ã‚‹</button>
      </div>
    </div>

    <!-- ç¢ºèªç”»é¢ -->
    <div id="confirmScreen" class="screen">
      <div class="card success-message">
        <h3>ğŸ‰ äºˆç´„å®Œäº†</h3>
        <div id="confirmInfo"></div>
      </div>
      <button class="btn" onclick="showScreen('reservationScreen')">æˆ»ã‚‹</button>
    </div>
  </div>

  <script>
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let currentUserId = null; // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    const bookings = {};

    // åˆæœŸç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // ãƒ­ã‚°ã‚¤ãƒ³
    function login() {
      const id = document.getElementById('studentId').value;
      const pw = document.getElementById('password').value;
      if (id === '1234567' && pw === 'demo1234') {
        currentUserId = id; // è¨­å®š
        document.getElementById('currentUserDisplay').textContent = currentUserId;
        document.getElementById('userIds').value = currentUserId;
        showScreen('reservationScreen');
        initCalendar();
      } else {
        showScreen('loginErrorScreen');
      }
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
    function initCalendar() {
      updateCalendar();
    }
    function updateCalendar() {
      const monthNames = ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
      document.getElementById('currentMonth').textContent = `${currentDate.getFullYear()}å¹´ ${monthNames[currentDate.getMonth()]}`;
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(d => {
        const el = document.createElement('div');
        el.className = 'calendar-day weekday-name';
        el.textContent = d;
        cal.appendChild(el);
      });
      const first = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
      for (let i = 0; i < first.getDay(); i++) {
        const empty = document.createElement('div');
        empty.className = 'calendar-day other-month';
        cal.appendChild(empty);
      }
      const last = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0);
      for (let d = 1; d <= last.getDate(); d++) {
        const el = document.createElement('div');
        el.className = 'calendar-day';
        el.textContent = d;
        const key = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), d);
        if (dayDate < new Date()) {
          el.classList.add('other-month');
        } else {
          el.classList.add(bookings[key] && bookings[key].full ? 'fully-booked' : 'available');
          el.onclick = () => selectDate(key, el);
        }
        cal.appendChild(el);
      }
    }

    // æœˆé€ã‚Š
    function changeMonth(dir) {
      currentDate.setMonth(currentDate.getMonth() + dir);
      selectedDate = null;
      document.getElementById('timeSection').innerHTML = '';
      updateCalendar();
    }

    // æ—¥ä»˜é¸æŠ
    function selectDate(date, el) {
      if (bookings[date] && bookings[date].full) return;
      document.querySelectorAll('.calendar-day.selected').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      selectedDate = date;
      showTimeSlots();
    }

    // æ™‚é–“å¸¯è¡¨ç¤º
    function showTimeSlots() {
      const container = document.getElementById('timeSection');
      container.innerHTML = '';
      const slots = ['09:00','10:00','11:00','13:00','14:00','15:00','16:00','17:00','18:00'];
      slots.forEach(t => {
        const btn = document.createElement('div');
        btn.className = 'time-slot' + ((bookings[selectedDate] && bookings[selectedDate].slots && bookings[selectedDate].slots.includes(t)) ? ' booked' : '');
        btn.textContent = t;
        if (!btn.classList.contains('booked')) btn.onclick = () => selectTime(btn, t);
        container.appendChild(btn);
      });
    }

    // æ™‚é–“é¸æŠ
    function selectTime(el, time) {
      document.querySelectorAll('.time-slot.selected').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      selectedTime = time;
    }

    // é †ç•ªäºˆç´„
    function reserveSequential() {
      const ids = document.getElementById('userIds').value.split(',').map(v=>v.trim()).filter(v=>v);
      if (!selectedDate || !selectedTime || ids.length === 0) {
        alert('æ—¥ä»˜ãƒ»æ™‚é–“ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„'); return;
      }
      if (!bookings[selectedDate]) bookings[selectedDate] = { slots: [], full: false };
      bookings[selectedDate].slots.push(selectedTime);
      bookings[selectedDate].full = true;
      document.getElementById('confirmInfo').innerHTML = `
        <p>è¬›å¸«: ç”°ä¸­å…ˆç”Ÿ</p>
        <p>æ—¥æ™‚: ${selectedDate} ${selectedTime}</p>
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${ids.join(', ')}</p>
      `;
      showScreen('confirmScreen');
    }
  </script>
</body>
</html>
